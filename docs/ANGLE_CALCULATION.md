# 角度计算说明

## 剑的默认方向

剑的默认方向是**从左下到右上（↗）**，这对应于 **-45 度**（或者说 315 度）。

在标准坐标系中：
- 向右 → : 0°
- 右下 ↘ : 45°
- 向下 ↓ : 90°
- 左下 ↙ : 135°
- 向左 ← : 180° (或 -180°)
- 左上 ↖ : -135° (或 225°)
- 向上 ↑ : -90° (或 270°)
- 右上 ↗ : -45° (或 315°) ← **剑的默认方向**

## 角度转换逻辑

1. **鼠标移动角度**: 使用 `Math.atan2(dy, dx)` 计算，以正右方向（→）为 0 度
2. **剑的旋转角度**: 由于剑默认指向右上（↗，-45°），需要加上偏移量
   - 目标角度 = 鼠标角度 - (-45°) = 鼠标角度 + 45°

## 角度变化阈值

为了避免频繁的小幅度旋转抖动，增加了 **3 度的阈值**：
- 只有当新角度与当前角度的差值 ≥ 3° 时，才更新旋转
- 角度差计算时考虑了循环（-180° 到 180° 的标准化）

## 示例

| 鼠标方向 | 鼠标角度 | 剑旋转角度 (鼠标角度 + 45°) | 剑最终指向 |
|---------|---------|---------------------------|-----------|
| → 向右  | 0°      | 45°                       | → 向右 |
| ↘ 右下  | 45°     | 90°                       | ↘ 右下 |
| ↓ 向下  | 90°     | 135°                      | ↓ 向下 |
| ↙ 左下  | 135°    | 180°                      | ↙ 左下 |
| ← 向左  | 180°    | 225°                      | ← 向左 |
| ↖ 左上  | -135°   | -90°                      | ↖ 左上 |
| ↑ 向上  | -90°    | -45°                      | ↑ 向上 |
| ↗ 右上  | -45°    | 0°                        | ↗ 右上（默认） |

## 旋转中心点

剑的旋转中心点设置在 **SVG 的右上角**（剑尖位置）：
- `transform-origin: 100% 0%` - 右上角作为旋转轴心
- `translate(-100%, 0%)` - 将右上角对齐到鼠标位置
- 这样剑尖始终在鼠标位置，剑身围绕剑尖旋转

## 代码实现

```typescript
// 默认角度：剑SVG默认指向右上（↗），即 -45度
private currentAngle: number = -45;
private readonly ANGLE_THRESHOLD: number = 3; // 角度变化阈值

// 创建元素时设置旋转中心
this.cursorElement.style.cssText = `
  transform-origin: 100% 0%;  // 右上角作为旋转中心
  transform: translate(-100%, 0%) rotate(${this.currentAngle}deg);
`;

// 角度计算
const mouseAngle = Math.atan2(dy, dx) * (180 / Math.PI);
// 剑需要旋转的角度 = 鼠标角度 - 剑默认角度(-45) = 鼠标角度 + 45
const targetAngle = mouseAngle + 45;

// 角度差计算（标准化到 -180 到 180）
let angleDiff = targetAngle - this.currentAngle;
while (angleDiff > 180) angleDiff -= 360;
while (angleDiff < -180) angleDiff += 360;

// 阈值过滤
if (Math.abs(angleDiff) < this.ANGLE_THRESHOLD) {
  return; // 角度变化太小，不更新
}
```

